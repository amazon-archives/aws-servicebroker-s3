AWSTemplateFormatVersion: 2010-09-09
Description: ' Template for Production S3. qs-1nt0fs937'
Parameters:
  ApplicationName:
    Description: >-
      This will be set as the value for the "APPLICATION_NAME" tag on all
      supported resources
    Type: String
  BucketName:
    Description: >-
      Must contain only lowercase letters, numbers, periods (.), and hyphens
      (-),Cannot end in numbers
    Type: String
    Default: apps3bucket
  LoggingPrefix:
    Description: >-
      Must contain only lowercase letters, numbers, periods (.), and hyphens
      (-),Cannot end in numbers
    Type: String
    Default: Archive
  EnableLogging:
    Description: enable or discable S3 logging
    Type: String
    AllowedValues:
      - 'True'
      - 'False'
    Default: 'True'
  EnableGlacierLifeCycle:
    Description: enable archiving to Glacier Storage
    Type: String
    AllowedValues:
      - 'True'
      - 'False'
    Default: 'False'
  GlacierLifeCycleTransitionInDays:
    Description: Define how many days objects should exist before being moved to Glacier
    Type: String
    Default: '0'
  EnableVersioning:
    Description: enable versioning
    Type: String
    AllowedValues:
      - 'True'
      - 'False'
    Default: 'False'
  LifeCyclePrefix:
    Description: >-
      Must contain only lowercase letters, numbers, periods (.), and hyphens
      (-),Cannot end in numbers
    Type: String
    Default: Archive
  BucketAccessControl:
    Description: define if the bucket can be accessed from public or private locations
    Type: String
    AllowedValues:
      - Private
      - PublicRead
      - PublicReadWrite
      - AuthenticatedRead
      - LogDeliveryWrite
      - BucketOwnerRead
      - BucketOwnerFullControl
      - AwsExecRead
    Default: "Private"
Mappings: {}
Conditions:
  UseLogging: !Equals 
    - !Ref EnableLogging
    - 'True'
  UseGlacierLifeCycle: !Equals 
    - !Ref EnableGlacierLifeCycle
    - 'True'
  UseVersioning: !Equals 
    - !Ref EnableVersioning
    - 'True'
Resources:
  S3bucket:
    Type: 'AWS::S3::Bucket'
    Properties:
      BucketName: !Ref BucketName
      AccessControl: !Ref BucketAccessControl
      LifecycleConfiguration:
        Rules:
          - Id: GlacierRule
            Prefix: !Ref LifeCyclePrefix
            Status: Enabled
            ExpirationInDays: '365'
            Transitions:
              - TransitionInDays: !Ref GlacierLifeCycleTransitionInDays
                StorageClass: Glacier
      LoggingConfiguration: !If 
        - UseLogging
        - DestinationBucketName: !Ref LoggingBucket
          LogFilePrefix: !Ref LoggingPrefix
        - !Ref 'AWS::NoValue'
      Tags:
        - Key: ApplicationName
          Value: !Ref ApplicationName
      VersioningConfiguration: !If 
        - UseVersioning
        - Status: Enabled
        - !Ref 'AWS::NoValue'
    DeletionPolicy: Retain
  LoggingBucket:
    Condition: UseLogging
    Type: 'AWS::S3::Bucket'
    Properties:
      AccessControl: LogDeliveryWrite
      BucketName: !Join 
        - ''
        - - !Ref BucketName
          - logging
Outputs:
  BucketName:
    Value: !Ref S3bucket
    Description: Name of the sample Amazon S3 bucket.
  BucketArn:
    Value: !GetAtt 
      - S3bucket
      - Arn
    Description: Name of the Amazon S3 bucket
